import{r as j,j as t}from"./index-acdb4e57.js";import{U as K,S as H,D as R,n as v,e as Y}from"./save_excel-fe5627e7.js";import{a as b,C as G}from"./axios-438ca07f.js";import{C as Q,c as X}from"./index-c37e4282.js";import{F as T,c as N,d as Z,P as L,e as A,T as ee}from"./index-bd973f08.js";import{I as F,S as m,P as te}from"./index-34d6b05d.js";import{a1 as w,a3 as se}from"./EditOutlined-5bc00953.js";import{L as ae}from"./index-4e46d175.js";import{S as ne}from"./index-4e31701e.js";import{m as re}from"./index-88e0a2f6.js";const z={ethereum:"ETH",dai:"DAI","usd-coin":"USDC",tether:"USDT","wrapped-bitcoin":"WBTC"};async function oe(){const r=`https://api.coingecko.com/api/v3/simple/price?ids=${Object.keys(z).join(",")}&vs_currencies=usd`;try{const o=await b.get(r),i={};for(const s in o.data){const n=z[s];n&&(i[n]=o.data[s].usd)}return i}catch(o){throw new Error("Error fetching token prices:",o.message)}}async function ie(l){let r=1,o=[];const i=await oe();for(;;){const s=`https://voyager.online/api/contract/${l}/transfers?ps=50&p=${r}`,n=await b.get(s),{items:u,lastPage:p}=n.data;if(u.forEach(g=>{const{tx_hash:h,transfer_from:k,transfer_to:x,transfer_value:S,token_symbol:I,token_type:E,token_decimals:$}=g,O={tx_hash:h,transfer_from:k,transfer_to:x,transfer_value:S,token_symbol:I,token_type:E,token_decimals:$,total_value:i.hasOwnProperty(I)?S*i[I]:0};o.push(O)}),p===r)break;r++}return o}async function le(l){let r=[],o=1;for(;;){const s=`https://voyager.online/api/txns?to=${l}&ps=50&p=${o}&type=null`,n=await b.get(s),{items:u,lastPage:p}=n.data;if(u.forEach(g=>{const{actual_fee:h,hash:k,timestamp:x}=g,S={actual_fee:Number(h)/10**18,hash:k,timestamp:x,transfer:[]};r.push(S)}),p===o)break;o++}return(await ie(l)).forEach(s=>{r.forEach(n=>{n.hash===s.tx_hash&&n.transfer.push(s)})}),r}const ce=l=>{const r=new Date(l)*1e3,o=(new Date().getTime()-new Date(r).getTime())/1e3;if(o<60)return Math.round(o)+" 秒前";const i=o/60;if(i<60)return Math.round(i)+" 分前";const s=i/60;if(s<24)return Math.round(s)+" 时前";const n=s/24;return Math.round(n)+" 天前"},de=l=>{const r=l.getFullYear(),o=new Date(r,0,1),i=(l.getDay()+6)%7,s=Math.floor((l.getTime()-o.getTime())/864e5),n=Math.floor((s+o.getDay()-i)/7);return`${r}-${n}`},ue=(l,r)=>{let o=0;const i=new Set,s=new Set,n=new Set;return r.forEach(u=>{const p=new Date(u.timestamp*1e3);o+=u.actual_fee;const g=p.getFullYear(),h=p.getMonth();console.log(`year: ${g}, month: ${h}`);const k=p.getDate(),x=de(p);i.add(`${g} -${h} -${k}`),s.add(`${g} -${x}`),n.add(`${g} -${h}`)}),{fee:o.toFixed(3),days:i.size,weeks:s.size,months:n.size}},me=async(l,r)=>{const{fee:o,days:i,weeks:s,months:n}=ue(l,r),u=r[0],p=ce(u.timestamp)||"无交易";return{fee:o,days:i,weeks:s,months:n,lastTransactionTimeAgo:p}};async function ge(){const r=`https://api.coingecko.com/api/v3/simple/price?ids=${["ethereum","dai","tether","usd-coin","wrapped-bitcoin"].join(",")}&vs_currencies=usd`;let o={},i={ethereum:{sym:0,dec:18},dai:{sym:1,dec:18},"usd-coin":{sym:2,dec:6},tether:{sym:3,dec:6},"wrapped-bitcoin":{sym:4,dec:8}};try{const s=await b.get(r);for(const n in s.data)o[i[n].sym]=s.data[n].usd/10**i[n].dec;return o}catch(s){return console.error("Error fetching token prices:",s.message),null}}async function he(l){try{let r=0,o=0,i=0,s=0,n=1,u=await ge(),p=[];for(;;){const g=await b.get(`https://voyager.online/api/contract/${l}/bridgeTransactions?ps=50&p=${n}`);if(p=[...p,...g.data.items],g.data.lastPage===n||g.data.lastPage===0||g.data.items.length===0)break;n++}return p.forEach(g=>{const{token_id:h,amount:k,type:x}=g;x===0&&(r++,i+=k*u[h]),x===2&&(o++,s+=k*u[h])}),{l1_l2:r,l2_l1:o,l1_l2_amount:Number(i.toFixed(2)),l2_l1_amount:Number(s.toFixed(2))}}catch{return{l1_l2:"-",l2_l1:"-",l1_l2_amount:"-",l2_l1_amount:"-"}}}async function ye(l){try{const r=await b.get(`https://voyager.online/api/contract/${l}`),{classAlias:o,nonce:i}=r.data;return{classAlias:o==="BraavosProxy"?"Braavos":"Argent",nonce:parseInt(i,16)}}catch{return{classAlias:"-",nonce:"-"}}}async function pe(l){try{const r=await b.get(`https://voyager.online/api/contract/${l}/balances`);let o={},i=0;for(const s in r.data){const n=r.data[s].usd.replace("$","");o[r.data[s].symbol]=parseFloat(r.data[s].amount).toFixed(3),i+=Number(n).toFixed(3)}return{...o}}catch{return{ETH:"-",DAI:"-",USDC:"-",USDT:"-",WBTC:"-"}}}const fe=l=>{let r=0;return l.forEach(o=>{const i=o.transfer.sort((n,u)=>parseInt(u.total_value)-parseInt(n.total_value));if(i.length===0)return;const s=parseFloat(i[0].total_value);r+=s}),{volume:r.toFixed(3)}},C=async l=>{const r=await le(l),o=await me(l,r),i=await he(l),s=await ye(l),n=await pe(l),u=fe(r);return{activity:o,bridge:i,account:s,tokenBalance:n,volume:u}};const{TextArea:ke}=F,{Content:xe}=ae,Ee=()=>{const[l,r]=j.useState(!1),[o,i]=j.useState(!1),[s,n]=j.useState([]),[u]=T.useForm(),[p,g]=j.useState(!1),[h,k]=j.useState([]),[x,S]=j.useState(!1),[I]=T.useForm();let E=s.length;j.useEffect(()=>{S(!0);const e=localStorage.getItem("stark_addresses");setTimeout(()=>{S(!1)},500),e&&n(JSON.parse(e))},[]);const $=[{title:"#",key:"index",align:"center",render:(e,a,c)=>c+1},{title:"备注",dataIndex:"name",key:"name",align:"center",className:"name",render:(e,a)=>a.key===W?t.jsx(F,{placeholder:"请输入备注",defaultValue:e,onPressEnter:y=>{a.name=y.target.value,n([...s]),localStorage.setItem("stark_addresses",JSON.stringify(s)),B(null)}}):t.jsxs(t.Fragment,{children:[t.jsx(ee,{color:"blue",children:e}),t.jsx(w,{shape:"circle",icon:t.jsx(se,{}),size:"small",onClick:()=>B(a.key)})]})},{title:"钱包地址",dataIndex:"address",key:"address",align:"center",className:"address",render:(e,a)=>{const c=()=>{X(e),re.success("地址已复制")};return e?t.jsxs(t.Fragment,{children:[e.slice(0,4),"...",e.slice(-4),t.jsx(w,{type:"text",icon:t.jsx(Q,{}),onClick:c,style:{marginLeft:8}})]}):t.jsx(m,{})}},{title:"Type",dataIndex:["account","classAlias"],key:"classAlias",align:"center",render:(e,a)=>e||t.jsx(m,{})},{title:"StarkWare(轻点刷新!不然容易报错)",className:"zksync2",children:[{title:"ETH",dataIndex:["tokenBalance","ETH"],key:"stark_eth_balance",align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"USDC",dataIndex:["tokenBalance","USDC"],key:"stark_usdc_balance",align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"USDT",dataIndex:["tokenBalance","USDT"],key:"stark_usdt_balance",align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"DAI",dataIndex:["tokenBalance","DAI"],key:"stark_dai_balance",align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"WBTC",dataIndex:["tokenBalance","WBTC"],key:"stark_wbtc_balance",align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"Tx",dataIndex:["account","nonce"],key:"stark_tx_amount",align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{}),sorter:(e,a)=>e.account.nonce-a.account.nonce},{title:"最后交易",dataIndex:["activity","lastTransactionTimeAgo"],key:"stark_latest_tx",align:"center",render:(e,a)=>e||e===0?t.jsx("a",{href:`https://voyager.online/contract/${a.address}`,target:"_blank",children:e}):t.jsx(m,{})},{title:"官方桥Tx",className:"stark_cross_tx",children:[{title:"L1->L2",dataIndex:["bridge","l1_l2"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"L2->L1",dataIndex:["bridge","l2_l1"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})}]},{title:"官方桥金额(U)",className:"stark_cross_amount",children:[{title:"L1->L2",dataIndex:["bridge","l1_l2_amount"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"L2->L1",dataIndex:["bridge","l2_l1_amount"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})}]},{title:"活跃统计",className:"stark_activity",children:[{title:"天",dataIndex:["activity","days"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"周",dataIndex:["activity","weeks"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"月",dataIndex:["activity","months"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{})},{title:"金额(U)",dataIndex:["volume","volume"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{}),sorter:(e,a)=>e.volume.volume-a.volume.volume},{title:"fee(E)",dataIndex:["activity","fee"],align:"center",render:(e,a)=>e||e===0?e:t.jsx(m,{}),sorter:(e,a)=>e.activity.fee-a.activity.fee}]},{title:"操作",key:"action",align:"center",render:(e,a)=>t.jsx(ne,{size:"small",children:t.jsx(L,{title:"确认删除？",onConfirm:()=>M(a.key),children:t.jsx(w,{icon:t.jsx(A,{})})})})}]}],O=async()=>{try{const e=await I.validateFields();if(e.address.length!==66&&e.address.length!==64){v.error({message:"错误",description:"请输入正确的stark地址(64位)"},2);return}e.address.startsWith("0x")||(e.address="0x"+e.address),r(!1);const a=s.findIndex(c=>c.address===e.address);if(a!==-1)n(s.map((c,y)=>y===a?{...c,name:e.name}:c)),C(e.address).then(c=>{n(y=>{const d=[...y];return d[a]={...d[a],...c},localStorage.setItem("stark_addresses",JSON.stringify(d)),d})});else{const c={key:s.length.toString(),name:e.name,address:e.address};n(y=>[...y,c]),C(e.address).then(y=>{n(d=>{const f=[...d];return f[f.length-1]={...f[f.length-1],...y},localStorage.setItem("stark_addresses",JSON.stringify(f)),f})})}}catch(e){v.error({message:"错误",description:e.message},2)}finally{I.resetFields()}},M=e=>{n(s.filter(a=>a.key!==e)),localStorage.setItem("stark_addresses",JSON.stringify(s.filter(a=>a.key!==e)))},P=async()=>{try{const a=(await u.validateFields()).addresses.split(`
`);for(let c of a){if(c=c.trim(),c.length!==66&&c.length!==64){v.error({message:"错误",description:"请输入正确的stark地址(64位)"});continue}c.startsWith("0x")||(c="0x"+c);const y=s.findIndex(d=>d.address===c);if(y!==-1){const d=await C(c);n(f=>{const _=[...f];return _[y]={..._[y],...d},localStorage.setItem("stark_addresses",JSON.stringify(_)),_})}else{const d={key:E.toString(),address:c};E++,n(_=>[..._,d]);const f=await C(c);n(_=>{const D=[..._];return D[D.length-1]={...D[D.length-1],...f},localStorage.setItem("stark_addresses",JSON.stringify(D)),D})}}i(!1)}catch(e){v.error({message:"错误",description:e.message})}finally{u.resetFields(),k([])}},U=async()=>{if(!h.length){v.error({message:"错误",description:"请先选择要刷新的地址"},2);return}g(!0);try{for(let e of h){const a=s.findIndex(c=>c.key===e);if(a!==-1){n(y=>{const d=[...y];for(let f in d[a])f!=="address"&&f!=="name"&&f!=="key"&&(d[a][f]=null);return d});const c=await C(s[a].address);n(y=>{const d=[...y];return d[a]={...d[a],...c},localStorage.setItem("stark_addresses",JSON.stringify(d)),d})}}}catch(e){v.error({message:"错误",description:e.message},2)}finally{g(!1),k([])}},J=()=>{if(!h.length){v.error({message:"错误",description:"请先选择要删除的地址"},2);return}n(s.filter(e=>!h.includes(e.key))),localStorage.setItem("stark_addresses",JSON.stringify(s.filter(e=>!h.includes(e.key)))),k([])},V=()=>{Y(s,"starkInfo")},[W,B]=j.useState(null),q={selectedRowKeys:h,onChange:e=>{k(e)}};return t.jsx("div",{children:t.jsxs(xe,{children:[t.jsx(N,{title:"批量添加地址",open:o,onOk:P,onCancel:()=>{i(!1),u.resetFields()},okText:"添加地址",cancelText:"取消",width:800,children:t.jsx(T,{form:u,layout:"vertical",children:t.jsx(T.Item,{label:"地址",name:"addresses",rules:[{required:!0}],children:t.jsx(ke,{placeholder:"请输入地址，每行一个",style:{width:"100%",height:"300px",resize:"none"}})})})}),t.jsx(N,{title:"添加地址",open:l,onOk:O,onCancel:()=>r(!1),okText:"添加地址",cancelText:"取消",width:800,children:t.jsxs(T,{form:I,layout:"vertical",children:[t.jsx(T.Item,{label:"地址",name:"address",rules:[{required:!0}],children:t.jsx(F,{placeholder:"请输入地址",style:{width:"100%"}})}),t.jsx(T.Item,{label:"备注",name:"name",children:t.jsx(F,{placeholder:"请输入备注",style:{width:"100%"}})})]})}),t.jsx("div",{style:{marginBottom:"50px"},children:t.jsx(m,{spinning:x,children:t.jsx(Z,{rowSelection:q,dataSource:s,pagination:!1,bordered:!0,style:{marginBottom:"20px"},size:"small",columns:$})})}),t.jsx("div",{className:"stark_footer",children:t.jsx(G,{size:"small",style:{width:"100%"},children:t.jsxs("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"},children:[t.jsx(w,{type:"primary",onClick:()=>{r(!0)},size:"large",style:{width:"20%"},icon:t.jsx(te,{}),children:"添加地址"}),t.jsx(w,{type:"primary",onClick:()=>{i(!0)},size:"large",style:{width:"20%"},icon:t.jsx(K,{}),children:"批量添加地址"}),t.jsx(w,{type:"primary",onClick:U,loading:p,size:"large",style:{width:"20%"},icon:t.jsx(H,{}),children:"刷新选中地址"}),t.jsx(L,{title:"确认删除"+h.length+"个地址？",onConfirm:J,children:t.jsx(w,{type:"primary",danger:!0,size:"large",style:{width:"20%"},icon:t.jsx(A,{}),children:"删除选中地址"})}),t.jsx(w,{type:"primary",icon:t.jsx(R,{}),size:"large",style:{width:"8%"},onClick:V})]})})})]})})};export{Ee as default};
